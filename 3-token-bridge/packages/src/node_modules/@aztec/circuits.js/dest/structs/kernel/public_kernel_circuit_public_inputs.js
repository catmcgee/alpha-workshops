import { BufferReader, serializeToBuffer } from '@aztec/foundation/serialize';
import { inspect } from 'util';
import { AggregationObject } from '../aggregation_object.js';
import { ValidationRequests } from '../validation_requests.js';
import { CombinedAccumulatedData, PublicAccumulatedNonRevertibleData, PublicAccumulatedRevertibleData, } from './combined_accumulated_data.js';
import { CombinedConstantData } from './combined_constant_data.js';
/**
 * Outputs from the public kernel circuits.
 * All Public kernels use this shape for outputs.
 */
export class PublicKernelCircuitPublicInputs {
    constructor(
    /**
     * Aggregated proof of all the previous kernel iterations.
     */
    aggregationObject, // Contains the aggregated proof of all previous kernel iterations
    /**
     * Validation requests accumulated from public functions.
     */
    validationRequests, 
    /**
     * Accumulated side effects and enqueued calls that are not revertible.
     */
    endNonRevertibleData, 
    /**
     * Data accumulated from both public and private circuits.
     */
    end, 
    /**
     * Data which is not modified by the circuits.
     */
    constants, 
    /**
     * Indicates whether the setup kernel is needed.
     */
    needsSetup, 
    /**
     * Indicates whether the app logic kernel is needed.
     */
    needsAppLogic, 
    /**
     * Indicates whether the teardown kernel is needed.
     */
    needsTeardown, 
    /**
     * Indicates whether execution of the public circuit reverted.
     */
    reverted) {
        this.aggregationObject = aggregationObject;
        this.validationRequests = validationRequests;
        this.endNonRevertibleData = endNonRevertibleData;
        this.end = end;
        this.constants = constants;
        this.needsSetup = needsSetup;
        this.needsAppLogic = needsAppLogic;
        this.needsTeardown = needsTeardown;
        this.reverted = reverted;
        this.combined = undefined;
    }
    toBuffer() {
        return serializeToBuffer(this.aggregationObject, this.validationRequests, this.endNonRevertibleData, this.end, this.constants, this.needsSetup, this.needsAppLogic, this.needsTeardown, this.reverted);
    }
    get combinedData() {
        if (this.needsSetup || this.needsAppLogic || this.needsTeardown) {
            throw new Error('Cannot combine data when the circuit is not finished');
        }
        if (!this.combined) {
            this.combined = CombinedAccumulatedData.recombine(this.endNonRevertibleData, this.end, this.reverted);
        }
        return this.combined;
    }
    /**
     * Deserializes from a buffer or reader, corresponding to a write in cpp.
     * @param buffer - Buffer or reader to read from.
     * @returns A new instance of PublicKernelCircuitPublicInputs.
     */
    static fromBuffer(buffer) {
        const reader = BufferReader.asReader(buffer);
        return new PublicKernelCircuitPublicInputs(reader.readObject(AggregationObject), reader.readObject(ValidationRequests), reader.readObject(PublicAccumulatedNonRevertibleData), reader.readObject(PublicAccumulatedRevertibleData), reader.readObject(CombinedConstantData), reader.readBoolean(), reader.readBoolean(), reader.readBoolean(), reader.readBoolean());
    }
    static empty() {
        return new PublicKernelCircuitPublicInputs(AggregationObject.makeFake(), ValidationRequests.empty(), PublicAccumulatedNonRevertibleData.empty(), PublicAccumulatedRevertibleData.empty(), CombinedConstantData.empty(), false, false, false, false);
    }
    [inspect.custom]() {
        return `PublicKernelCircuitPublicInputs {
      aggregationObject: ${this.aggregationObject},
      validationRequests: ${inspect(this.validationRequests)},
      endNonRevertibleData: ${inspect(this.endNonRevertibleData)},
      end: ${inspect(this.end)},
      constants: ${this.constants},
      needsSetup: ${this.needsSetup},
      needsAppLogic: ${this.needsAppLogic},
      needsTeardown: ${this.needsTeardown},
      reverted: ${this.reverted}
      }`;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVibGljX2tlcm5lbF9jaXJjdWl0X3B1YmxpY19pbnB1dHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc3RydWN0cy9rZXJuZWwvcHVibGljX2tlcm5lbF9jaXJjdWl0X3B1YmxpY19pbnB1dHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRTlFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0IsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDL0QsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixrQ0FBa0MsRUFDbEMsK0JBQStCLEdBQ2hDLE1BQU0sZ0NBQWdDLENBQUM7QUFDeEMsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFbkU7OztHQUdHO0FBQ0gsTUFBTSxPQUFPLCtCQUErQjtJQUcxQztJQUNFOztPQUVHO0lBQ0ksaUJBQW9DLEVBQUUsa0VBQWtFO0lBQy9HOztPQUVHO0lBQ0ksa0JBQXNDO0lBQzdDOztPQUVHO0lBQ0ksb0JBQXdEO0lBQy9EOztPQUVHO0lBQ0ksR0FBb0M7SUFDM0M7O09BRUc7SUFDSSxTQUErQjtJQUN0Qzs7T0FFRztJQUNJLFVBQW1CO0lBQzFCOztPQUVHO0lBQ0ksYUFBc0I7SUFDN0I7O09BRUc7SUFDSSxhQUFzQjtJQUM3Qjs7T0FFRztJQUNJLFFBQWlCO1FBaENqQixzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBSXBDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFJdEMseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFvQztRQUl4RCxRQUFHLEdBQUgsR0FBRyxDQUFpQztRQUlwQyxjQUFTLEdBQVQsU0FBUyxDQUFzQjtRQUkvQixlQUFVLEdBQVYsVUFBVSxDQUFTO1FBSW5CLGtCQUFhLEdBQWIsYUFBYSxDQUFTO1FBSXRCLGtCQUFhLEdBQWIsYUFBYSxDQUFTO1FBSXRCLGFBQVEsR0FBUixRQUFRLENBQVM7UUF0Q2xCLGFBQVEsR0FBd0MsU0FBUyxDQUFDO0lBdUMvRCxDQUFDO0lBRUosUUFBUTtRQUNOLE9BQU8saUJBQWlCLENBQ3RCLElBQUksQ0FBQyxpQkFBaUIsRUFDdEIsSUFBSSxDQUFDLGtCQUFrQixFQUN2QixJQUFJLENBQUMsb0JBQW9CLEVBQ3pCLElBQUksQ0FBQyxHQUFHLEVBQ1IsSUFBSSxDQUFDLFNBQVMsRUFDZCxJQUFJLENBQUMsVUFBVSxFQUNmLElBQUksQ0FBQyxhQUFhLEVBQ2xCLElBQUksQ0FBQyxhQUFhLEVBQ2xCLElBQUksQ0FBQyxRQUFRLENBQ2QsQ0FBQztJQUNKLENBQUM7SUFFRCxJQUFJLFlBQVk7UUFDZCxJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDaEUsTUFBTSxJQUFJLEtBQUssQ0FBQyxzREFBc0QsQ0FBQyxDQUFDO1FBQzFFLENBQUM7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ25CLElBQUksQ0FBQyxRQUFRLEdBQUcsdUJBQXVCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN4RyxDQUFDO1FBQ0QsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUE2QjtRQUM3QyxNQUFNLE1BQU0sR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdDLE9BQU8sSUFBSSwrQkFBK0IsQ0FDeEMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUNwQyxNQUFNLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLEVBQ3JDLE1BQU0sQ0FBQyxVQUFVLENBQUMsa0NBQWtDLENBQUMsRUFDckQsTUFBTSxDQUFDLFVBQVUsQ0FBQywrQkFBK0IsQ0FBQyxFQUNsRCxNQUFNLENBQUMsVUFBVSxDQUFDLG9CQUFvQixDQUFDLEVBQ3ZDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsRUFDcEIsTUFBTSxDQUFDLFdBQVcsRUFBRSxFQUNwQixNQUFNLENBQUMsV0FBVyxFQUFFLEVBQ3BCLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FDckIsQ0FBQztJQUNKLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBSztRQUNWLE9BQU8sSUFBSSwrQkFBK0IsQ0FDeEMsaUJBQWlCLENBQUMsUUFBUSxFQUFFLEVBQzVCLGtCQUFrQixDQUFDLEtBQUssRUFBRSxFQUMxQixrQ0FBa0MsQ0FBQyxLQUFLLEVBQUUsRUFDMUMsK0JBQStCLENBQUMsS0FBSyxFQUFFLEVBQ3ZDLG9CQUFvQixDQUFDLEtBQUssRUFBRSxFQUM1QixLQUFLLEVBQ0wsS0FBSyxFQUNMLEtBQUssRUFDTCxLQUFLLENBQ04sQ0FBQztJQUNKLENBQUM7SUFFRCxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFDZCxPQUFPOzJCQUNnQixJQUFJLENBQUMsaUJBQWlCOzRCQUNyQixPQUFPLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDOzhCQUM5QixPQUFPLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDO2FBQ25ELE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO21CQUNYLElBQUksQ0FBQyxTQUFTO29CQUNiLElBQUksQ0FBQyxVQUFVO3VCQUNaLElBQUksQ0FBQyxhQUFhO3VCQUNsQixJQUFJLENBQUMsYUFBYTtrQkFDdkIsSUFBSSxDQUFDLFFBQVE7UUFDdkIsQ0FBQztJQUNQLENBQUM7Q0FDRiJ9